---
import Layout from './Layout.astro';
import Breadcrumb from '@/components/Breadcrumb.astro';

export interface Props {
  title: string;
  description: string;
  pubDate: Date;
  category: string;
  readTime: string;
  image?: string;
  author?: string;
  slug: string;
}

const {
  title,
  description,
  pubDate,
  category,
  readTime,
  image,
  author = 'Equipe Projekt',
  slug,
} = Astro.props;

const siteUrl = 'https://projekt.com.br';
const postUrl = `${siteUrl}/insights/${slug}`;
const formattedDate = pubDate.toLocaleDateString('pt-BR', {
  day: '2-digit',
  month: 'long',
  year: 'numeric',
});
const isoDate = pubDate.toISOString();

const articleSchema = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: title,
  description: description,
  url: postUrl,
  datePublished: isoDate,
  dateModified: isoDate,
  author: {
    '@type': 'Organization',
    name: author,
    url: siteUrl,
  },
  publisher: {
    '@type': 'Organization',
    name: 'Projekt',
    url: siteUrl,
    logo: {
      '@type': 'ImageObject',
      url: `${siteUrl}/images/logo.svg`,
    },
  },
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': postUrl,
  },
  ...(image ? { image: `${siteUrl}${image}` } : {}),
};

const breadcrumbItems = [
  { label: 'Início', href: '/' },
  { label: 'Insights', href: '/insights' },
  { label: title, href: `/insights/${slug}` },
];
---

<Layout title={title} description={description} canonical={postUrl} ogImage={image}>
  <!-- Article Schema -->
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} slot="head" />

  <article class="pt-8 pb-20">
    <div class="container" style="max-width:1280px;margin:0 auto;padding:0 1.5rem;">
      <!-- Breadcrumb -->
      <div class="mb-8">
        <Breadcrumb items={breadcrumbItems} />
      </div>

      <!-- Article Header -->
      <header class="max-w-3xl mx-auto mb-12 text-center">
        <div class="flex items-center justify-center gap-3 mb-6">
          <span class="tag">{category}</span>
          <span style="color:var(--text-muted);font-size:0.875rem;">{formattedDate}</span>
          <span style="color:var(--text-muted);font-size:0.875rem;">·</span>
          <span style="color:var(--text-muted);font-size:0.875rem;">{readTime}</span>
        </div>

        <h1 class="section-title gradient-text mb-6" style="font-size:clamp(2rem,5vw,3.5rem);">
          {title}
        </h1>

        <p style="font-size:1.125rem;color:var(--text-muted);line-height:1.75;max-width:60ch;margin:0 auto;">
          {description}
        </p>

        <div class="flex items-center justify-center gap-2 mt-8">
          <div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;">
            <span style="color:#fff;font-size:0.75rem;font-weight:700;">P</span>
          </div>
          <span style="font-size:0.9rem;color:var(--text-muted);">por <strong style="color:var(--text);">{author}</strong></span>
        </div>
      </header>

      <!-- Divider -->
      <div class="divider mb-12 max-w-3xl mx-auto"></div>

      <!-- Article Content -->
      <div class="prose mx-auto" style="max-width:72ch;">
        <slot />
      </div>

      <!-- Article Footer -->
      <div class="max-w-3xl mx-auto mt-16 pt-8" style="border-top:1px solid var(--border);">
        <div class="flex flex-wrap items-center justify-between gap-4">
          <a href="/insights" class="btn-secondary" style="font-size:0.875rem;padding:0.6rem 1.25rem;">
            ← Voltar para Insights
          </a>
          <div class="flex items-center gap-3">
            <span style="font-size:0.875rem;color:var(--text-muted);">Compartilhar:</span>
            <a
              href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(postUrl)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="btn-ghost"
              style="padding:0.4rem 0.8rem;font-size:0.8rem;"
              aria-label="Compartilhar no LinkedIn"
            >
              LinkedIn
            </a>
            <a
              href={`https://wa.me/?text=${encodeURIComponent(title + ' — ' + postUrl)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="btn-ghost"
              style="padding:0.4rem 0.8rem;font-size:0.8rem;"
              aria-label="Compartilhar no WhatsApp"
            >
              WhatsApp
            </a>
          </div>
        </div>
      </div>
    </div>
  </article>
</Layout>
